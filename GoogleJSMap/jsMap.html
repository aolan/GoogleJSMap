<!DOCTYPE html><html><head>    <meta charset="UTF-8">	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />	<style type="text/css">html { height: 100% } body { height: 100%; margin: 0; padding: 0 } #map_canvas { height: 100% } .map_point{position:absolute;} .map_point > span { left: 14px;position: absolute;top: 7px;}	</style>    <script type="text/javascript" src="window.mapDAO.demo.js"></script>	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=geometry&sensor=true&language=zhCN"></script><script type="text/javascript">var map = null;var markers = [];var orderTags = [];var tempArr = [];var infoWindow = null;var star = null;var myLocation = null;var withSmallStyle = false;var initializedVisuableMarkerSize = 0;// initialize地图加载函数function initialize() {    	if (typeof(google) === 'undefined') {        location.href = "js_download_failed";		return;	}	// 设置地图参数	var mapOptions = {		zoom : 15,		zoomControl: false,		mapTypeControl : false,		streetViewControl : false,		mapTypeId : google.maps.MapTypeId.ROADMAP	};	map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);	//控制地图的缩放级别	var MinZoomLevel = 3; //允许最小缩放级别    var MaxZoomLevel = 18;//允许最大缩放级别    google.maps.event.addListener(map, 'zoom_changed',function() {			var curZoom = map.getZoom();		if( curZoom < MinZoomLevel) map.setZoom(MinZoomLevel);			if( curZoom > MaxZoomLevel) 				map.setZoom(MaxZoomLevel);		    });	infoWindow = new google.maps.InfoWindow({			maxWidth : window.screen.availWidth / 4		});    location.href = "map_load_success";}// 添加Marker函数function setSmallStyle() {    	withSmallStyle = true;}function addMarker(pMarkers) {        if (markers.length > 0) {                location.href = "markers_not_empty";        		return;	}        var tmpString = decodeURIComponent(pMarkers);    //将字符串转换为数组    tempArr = tmpString.split(",,,,,.,,,,,");    initializedVisuableMarkerSize = 0;        if(tempArr.length > 0){                for(var i in tempArr){                        var jsonObj = JSON.parse(tempArr[i]);                        if(isoncerrent(jsonObj.latitude,jsonObj.longitude)){                                initializedVisuableMarkerSize++;                                if (initializedVisuableMarkerSize > 20){                                        break;                }            }        }                for (var i in tempArr) {            var jsonObj = JSON.parse(tempArr[i]);            orderTags.push(addTagOverlay(i, jsonObj.title));        }                for (var i in tempArr) {                        addMarkerInternal(i);        }    }}// 清除Marker函数function clearMarker() {	for (var i in markers) {		markers[i].setMap(null);	}		for (var i in orderTags){		orderTags[i].setMap(null);	}	orderTags.length = 0;	markers.length = 0;    tempArr.length = 0;}// 自动缩放地图函数function zoomToSpan(swLat, swLng, neLat, neLng) {	var swLatLng = new google.maps.LatLng(swLat, swLng); 	var neLatLng = new google.maps.LatLng(neLat, neLng);	var latLngBounds = new google.maps.LatLngBounds(swLatLng, neLatLng);	map.fitBounds(latLngBounds);}// 创建Marker函数function addMarkerInternal(index) {        if(index > tempArr.length) {            return;    }    	var coordinate = new google.maps.LatLng(JSON.parse(tempArr[index]).latitude, JSON.parse(tempArr[index]).longitude);    	var marker = new google.maps.Marker({			position : coordinate,			map : map,			draggable : false,						clickable : true,						icon: icon.original,						title: "fdsalkfjasf"		});            marker.index = index;	    markers.push(marker);    	google.maps.event.addListener(marker, 'click', function () {            	});}// 获取地图中心点经纬度坐标和屏幕半径, 然后回调Android层业务搜索function searchOnMap() {	window.mapDAO.searchOnScreenMapBy(map.getCenter().lat(), map.getCenter().lng(), getScreenMapRadius());}// 获取地图半径, 从地图中心点到屏幕顶部的物理投射距离function getScreenMapRadius() {	var center = map.getCenter();	var topCenter = new google.maps.LatLng(map.getBounds().getNorthEast().lat(), center.lng());	return google.maps.geometry.spherical.computeDistanceBetween(center, topCenter);}// 设置地图中心点function setMapCenter(lat, lng) {	map.setCenter(new google.maps.LatLng(lat, lng));}// 设置地图中心点、缩放比例function setMapCenterAndZoom(lat, lng, zoom) {	map.setCenter(new google.maps.LatLng(lat, lng));	map.setZoom(zoom);}function setMapCenterChangedListener() {	google.maps.event.addListener(map, 'center_changed', function () {		var center = map.getCenter();	});}// 设置地图星星function addStar(lat, lng, title, iconPath) {	if (star !== null) {		star.setMap(null);		star = null;	}	var starLatLng = new google.maps.LatLng(lat, lng);	star = new google.maps.Marker({			position : starLatLng,			map : map,			draggable : false,			icon : iconPath		});	if (title !== undefined && title.length > 0) {		google.maps.event.addListener(star, 'click', function () {			infoWindow.setContent(title);			infoWindow.open(map, star);		});	}	google.maps.event.addListener(star, 'click', function () {	});} //图标 var icon = {	original:'mark_replace.png'  //这张图片用于将infoWindow撑起高度来 }  var fontColor = {    purple:'#FFFFFF',	green: '#FFFFFF',	orange:'#FFFFFF' }function addTagOverlay(index,tagText){    if(index <= tempArr.length){        var marker = JSON.parse(tempArr[index]);                return new TagOverlay(new google.maps.LatLng(marker.latitude, marker.longitude), index, marker.markerTitle,marker.markerType, map);    }else{                return;    }}// TagOverlay定义(自定义标签)function TagOverlay(point, index, tagText, type,map, url) {	// 初始化参数：坐标、文字、地图	this.point_ = point;	this.index = index;	this.name_ = tagText;    this.type_ = type;	this.map_ = map;	this.url_ = url || '';    // 到onAdd时才需要创建div	this.div_ = null;	// 加入map	this.setMap(map);    }TagOverlay.prototype = new google.maps.OverlayView();TagOverlay.prototype.onAdd = function() {    //此方法是异步的	//创建一个div，其中包含了当前文字	var div = document.createElement('DIV');	div.className = 'map_point';	var color = this.index == 0 ? fontColor.purple : fontColor.green;		div.id = 'map_point' + this.index;	div.style.color = color;	div.style.zIndex = this.index == 0 ? 1 : 0;	var text = document.createTextNode(this.name_);		var img = document.createElement('DIV');	img.className = 'leftd';		var d1 = document.createElement('DIV');	d1.className = 'speech left';		var textdiv = document.createElement('DIV');	textdiv.className = 'content';	textdiv.appendChild(text);	d1.appendChild(textdiv);		var num = document.createElement('DIV');    if(this.type_ == 0){                num.className = 'num';        var a = parseFloat(this.index);        var b = parseFloat(1);        num.innerHTML = a+b;    }else{            d1.className  = "speech right"        num.className = 'backup';        num.innerHTML = '备选';    }    	if(withSmallStyle || initializedVisuableMarkerSize > 20){        		d1.style.display = "none";		img.className = "point";		if(num.innerHTML.indexOf("备")==0){			img.className = "point_bk";			num.innerHTML = '备';		}		num.className = 'mapmaker_num';	}		img.appendChild(d1);	img.appendChild(num);		div.appendChild(img);	this.div_ = div;	var panes = this.getPanes();    	panes.overlayMouseTarget.appendChild(div);		this.div_.onclick = function(){	          var index = parseInt(this.id.replace('map_point',''));       //用户点击lay，回调到native方法        location.href = "googleCtripMap://index="+index;	};  	google.maps.event.addListener(map, 'center_changed', function () {                                          changeicon();	});	// 设置Map Zoom Change Event	google.maps.event.addListener(map, 'zoom_changed', function () {		changeicon();	});};TagOverlay.prototype.setTextStyle = function(color) {   if(this.div_) {     var div = this.div_;     div.style.color = color;   }}TagOverlay.prototype.setIconSrc = function(icon) {   if(this.div_) {     // img = this.div_.getElementsByTagName('IMG')[0];     //img.src = icon;   }}//解决当前图标在最上面，但导致图标重合时，要关闭infoWindow层或放大才能点击下面那个。TagOverlay.prototype.setZIndex = function(zindex) {   if(this.div_) {      this.div_.style.zIndex = zindex;   }}TagOverlay.prototype.draw = function() {	// 利用projection获得当前视图的坐标	var overlayProjection = this.getProjection();	var center = overlayProjection.fromLatLngToDivPixel(this.point_);	var div = this.div_;	div.style.width = 'auto';	div.style.left = center.x - div.clientWidth/2+"px";	div.style.top = center.y - 60 +'px';};TagOverlay.prototype.onRemove = function() {	this.div_.parentNode.removeChild(this.div_);};function isoncerrent(l,n){	var xx =map.getBounds();	if(xx != undefined)		return xx.contains(new google.maps.LatLng(l, n));	return true;}function changeicon(){    var k = 0;	if (orderTags) {		for (i in orderTags) {		  if(isoncerrent(markers[i].position.k,markers[i].position.A)){			k++;			if (k > 20)				break;		  }		}				if(k>20) {			for (i in orderTags) {				//if(isoncerrent(markers[i].position.k,markers[i].position.A)){					orderTags[i].div_.childNodes[0].childNodes[0].style.display = "none";					orderTags[i].div_.childNodes[0].className="point";					if(orderTags[i].div_.childNodes[0].childNodes[1].innerHTML.indexOf("备")==0)					{						orderTags[i].div_.childNodes[0].className="point_bk";						orderTags[i].div_.childNodes[0].childNodes[1].innerHTML = "备"					}					orderTags[i].div_.childNodes[0].childNodes[1].className="mapmaker_num";				//}			}		} else {			for (i in orderTags) {				//if(isoncerrent(markers[i].position.k,markers[i].position.A)){					orderTags[i].div_.childNodes[0].childNodes[0].style.display = "";					orderTags[i].div_.childNodes[0].className="leftd";					orderTags[i].div_.childNodes[0].childNodes[1].className="num";					if(orderTags[i].div_.childNodes[0].childNodes[1].innerHTML.indexOf("备")==0)					{						orderTags[i].div_.childNodes[0].childNodes[1].innerHTML = "备选"						orderTags[i].div_.childNodes[0].childNodes[1].className="backup";					}				//}			}		}	}}</script> <style type="text/css">		div.num {		 position:absolute;		 margin-top:10px;		 margin-left:-10px;		 width: 20px;		 height: 20px;		 background: #1081E9;		 -moz-border-radius: 10px;		 -webkit-border-radius: 10px;		 border-radius: 10px;		 border:solid 1px #FFFFFF; 		 color:#FFFFFF;		 font-size:12px;		 text-align:center;		 line-height:20px		}		div.backup {		 position:absolute;		 margin-top:10px;		 margin-left:-10px;		 width: 30px;		 height: 15px;		 background: #1081E9;		 -moz-border-radius: 3px;		 -webkit-border-radius: 3px;		 border-radius: 3px;		 border:solid 1px #FFFFFF; 		 color:#FFFFFF;		 font-size:10px;		 text-align:center;		 line-height:15px		}		div.speech {		 margin: 19px 0;		 padding: 8px;		 table-layout: fixed;		 word-break: break-all;		 position: relative;		 background: -webkit-gradient( linear, 50% 0%, 50% 100%, from(#ffffff), color-stop(0.1, #ececec), color-stop(0.5, #dbdbdb), color-stop(0.9, #dcdcdc), to(#8c8c8c) );		 border: 1px solid #989898;		 -webkit-border-radius: 5px;		 -moz-border-radius: 5px;		 border-radius: 5px;		}		div.speech:before {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 left: 15px;		 top: -20px;		 border: 10px solid;		 border-color: transparent transparent #989898 transparent;		}		div.speech:after {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 left: 17px;		 top: -16px;		 border: 8px solid;		 border-color: transparent transparent #ffffff transparent;		}		div.content{			-o-text-overflow: ellipsis;		   text-overflow:ellipsis;		   overflow:hidden;		   white-space:nowrap;		   max-width: 125px;		}		div.speech.left {		 width: auto;		 float: left;		 background: #1081E9;		}		div.speech.left:before {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 31px;		 bottom: auto;		 margin-left:-10px;		 left: 50%;		 border: 10px solid;		 border-color: #989898 transparent transparent transparent;		}		div.speech.left:after {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 30px;		 margin-left:-10px;		 bottom: auto;		 left: 50%;		 border: 10px solid;		 border-color: #1081E9 transparent transparent transparent;		}		div.speech.right {		 width: auto;		 float: left;		 background: #777777;		}		div.speech.right:before {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 31px;		 bottom: auto;		 margin-left:-10px;		 left: 50%;		 border: 10px solid;		 border-color: #989898 transparent transparent transparent;		}		div.speech.right:after {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 30px;		 margin-left:-10px;		 bottom: auto;		 left: 50%;		 border: 10px solid;		 border-color: #777777 transparent transparent transparent;		}		.clear {		 clear: both;		}		div.mapmaker {		 margin: 10px 0;		 padding-top: 6px;		 padding-left: 3px;		 padding-right: 3px;		 padding-bottom: 6px;		 table-layout: fixed;		 word-break: break-all;		 position: relative;		 background: -webkit-gradient( linear, 50% 0%, 50% 100%, from(#ffffff), color-stop(0.1, #ececec), color-stop(0.5, #dbdbdb), color-stop(0.9, #dcdcdc), to(#8c8c8c) );		 border: 1px solid #989898;		 -webkit-border-radius: 25px;		 -moz-border-radius: 25px;		 border-radius: 25px;		}		div.mapmaker.left {		 width: 15px;		 float: left;		 background: #1081E9;		}		div.mapmaker.left:before {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 24px;		 bottom: auto;		 margin-left:-10px;		 left: 50%;		 border: 10px solid;		 border-color: #1081E9 transparent transparent transparent;		}		div.mapmaker.left:after {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 26px;		 margin-left:-10px;		 bottom: auto;		 left: 50%;		 border: 10px solid;		 border-color: #1081E9 transparent transparent transparent;		}		div.mapmaker_num{		text-align:center;		font-size:13px;		color:#FFFFFF;		z-index:9999;		}		div.mapmaker.bk {		 width: 15px;		 float: left;		 background: #989898;		}		div.mapmaker.bk:before {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 24px;		 bottom: auto;		 margin-left:-10px;		 left: 50%;		 border: 10px solid;		 border-color: #989898 transparent transparent transparent;		}		div.mapmaker.bk:after {		 content: '';		 position: absolute;		 width: 0;		 height: 0;		 top: 26px;		 margin-left:-10px;		 bottom: auto;		 left: 50%;		 border: 10px solid;		 border-color: #989898 transparent transparent transparent;		}		.point{height:26px; width:26px; display:block; position:relative;top:24px; left:0px;  line-height:26px; background:#1081E9; border-radius:40px;-webkit-border-radius:40px;-moz-border-radius:40px; color:#fff; text-align:center;}		.point:after{content:''; height:0px; width:0px;top:21.5px;display:block; position:absolute; bottom:2px; left:3px; border:10px transparent solid; border-top-color:#1081E9; border-width:15px 10px 0px 10px; }		.point_bk{height:26px; width:26px; display:block; position:relative;top:24px; left:0px;  line-height:26px; background:#989898; border-radius:40px;-webkit-border-radius:40px;-moz-border-radius:40px; color:#fff; text-align:center;}		.point_bk:after{content:''; height:0px; width:0px;top:21.5px;display:block; position:absolute; bottom:2px; left:3px; border:10px transparent solid; border-top-color:#989898; border-width:15px 10px 0px 10px; } </style></head><body onload="initialize()" >	<div id="map_canvas" style="width:100%; height:100%;"></div></body></html>